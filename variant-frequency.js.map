{"version":3,"file":"variant-frequency.js","sources":["../../../home/runner/work/nbdc-forked-togovar-stanza/nbdc-forked-togovar-stanza/stanzas/variant-frequency/index.js"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\n\nimport {DATASETS} from \"@/lib/constants\";\nimport {frequency} from \"@/lib/display\";\nimport {sortBy} from \"@/lib/sort\";\n\nexport default class VariantSummary extends Stanza {\n  async render() {\n    this.importWebFontCSS(\"https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700,900\");\n    this.importWebFontCSS(new URL(\"./assets/fontello.css\", import.meta.url));\n\n    const sparqlist = (this.params?.sparqlist || \"/sparqlist\").concat(`/api/variant_frequency?tgv_id=${this.params.tgv_id}`);\n\n    const r = await fetch(sparqlist, {\n      method: \"GET\",\n      headers: {\n        \"Accept\": \"application/json\"\n      }\n    }).then(function (response) {\n      if (response.ok) {\n        return response.json();\n      }\n      throw new Error(sparqlist + \" returns status \" + response.status);\n    }).then(function (bindings) {\n      const datasets = Object.values(DATASETS);\n\n      bindings.forEach(function (binding) {\n        const dataset = datasets.find(x => x.source === binding.source);\n        const ac = parseInt(binding.num_alt_alleles);\n        const freq = parseFloat(binding.frequency);\n\n        const localeString = (v) => v ? parseInt(v).toLocaleString() : null;\n\n        binding.key = dataset?.id;\n        binding.dataset = dataset?.dataset;\n        binding.population = dataset?.population;\n        binding.class_name = binding.source.startsWith(\"ExAC:\") ? \"none\" : \"\";\n        binding.num_alleles = localeString(binding.num_alleles);\n        binding.num_alt_alleles = localeString(binding.num_alt_alleles);\n        binding.num_genotype_alt_homo = localeString(binding.num_genotype_alt_homo);\n        binding.num_genotype_hetero = localeString(binding.num_genotype_hetero);\n        binding.num_genotype_ref_homo = localeString(binding.num_genotype_ref_homo);\n\n        Object.assign(binding, frequency(ac, freq));\n      });\n\n      sortBy(bindings, x => datasets.find(y => y.source === x.source)?.idx);\n\n      return {result: {bindings: bindings}};\n    }).catch(e => ({error: {message: e.message}}));\n\n    this.renderTemplate({\n      template: \"stanza.html.hbs\",\n      parameters: {\n        params: this.params,\n        ...r,\n      },\n    });\n\n    const gnomad_genomes = this.root.querySelector(\"#gnomad_genomes\");\n    if (gnomad_genomes) {\n      const gnomad_genomes_total = this.root.querySelector(\"tr[data-dataset='gnomad_genomes']\");\n      const gnomad_genomes_subset = this.root.querySelectorAll(\"tr[data-dataset^='gnomad_genomes_']\");\n\n      gnomad_genomes.addEventListener(\"click\", function () {\n        gnomad_genomes.classList.toggle(\"open\");\n        gnomad_genomes_total.classList.toggle(\"close\");\n\n        gnomad_genomes_subset.forEach(x => x.classList.toggle(\"none\"));\n      });\n    }\n\n    const gnomad_exomes = this.root.querySelector(\"#gnomad_exomes\");\n    if (gnomad_exomes) {\n      const gnomad_exomes_total = this.root.querySelector(\"tr[data-dataset='gnomad_exomes']\");\n      const gnomad_exomes_subset = this.root.querySelectorAll(\"tr[data-dataset^='gnomad_exomes_']\");\n\n      gnomad_exomes.addEventListener(\"click\", function () {\n        gnomad_exomes.classList.toggle(\"open\");\n        gnomad_exomes_total.classList.toggle(\"close\");\n\n        gnomad_exomes_subset.forEach(x => x.classList.toggle(\"none\"));\n      });\n    }\n  }\n}\n"],"names":[],"mappings":"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"}